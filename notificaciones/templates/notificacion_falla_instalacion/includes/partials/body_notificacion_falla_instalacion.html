<tr>
  <th scope="row">{{ object.id }}</th>
  <td><a href="{% url 'asignaciones:detail_asignacion_ni' object.asignacion_ni.pk %}">{{ object.asignacion_ni }}</a></td>
  <td>{{ object.actividad }}</td>
  <td><a href="{% url 'actividades:detail_actividad' object.actividad.pk %}">{{ object.wp }}</a></td>
  <td>{{ object.service_supplier }}</td>
  <td><a href="{% url 'estaciones:detail_estacion' object.estacion.pk %}">{{ object.estacion }}</a></td>
  <td>{{ object.banda }}</td>
  <td>{{ object.proyecto }}</td>
  <td>{{ object.escenario }}</td>
  <td><a href="{% url 'users:detail_perfil' object.ni_ingeniero.slug %}">{{ object.ni_ingeniero }}</a></td>
  <td id="contenido">{{ object.detalle_falla_instalacion }}</td>
  <td>{{ object.solver }}</td>
  <td>{{ object.creado }}</td>
  <td>{{ object.actualizado }}</td>
</tr>
<script>
(function($) {
  $.fn.shorten = function(settings) {
      "use strict";
      var config = {
          showChars: 100,
          minHideChars: 10,
          ellipsesText: "...",
          moreText: "more",
          lessText: "less",
          onLess: function() {},
          onMore: function() {},
          errMsg: null,
          force: false
      };
      if (settings) {
          $.extend(config, settings);
      }
      if ($(this).data('jquery.shorten') && !config.force) {
          return false;
      }
      $(this).data('jquery.shorten', true);
      $(document).off("click", '.morelink');
      $(document).on({
          click: function() {
              var $this = $(this);
              if ($this.hasClass('less')) {
                  $this.removeClass('less');
                  $this.html(config.moreText);
                  $this.parent().prev().animate({'height':'0'+'%'}, function () { $this.parent().prev().prev().show(); }).hide('fast', function() {
                      config.onLess();
                    });
              } else {
                  $this.addClass('less');
                  $this.html(config.lessText);
                  $this.parent().prev().animate({'height':'100'+'%'}, function () { $this.parent().prev().prev().hide(); }).show('fast', function() {
                      config.onMore();
                    });
              }
              return false;
          }
      }, '.morelink');
      return this.each(function() {
          var $this = $(this);
          var content = $this.html();
          var contentlen = $this.text().length;
          if (contentlen > config.showChars + config.minHideChars) {
              var c = content.substr(0, config.showChars);
              if (c.indexOf('<') >= 0)
              {
                  var inTag = false;
                  var bag = '';
                  var countChars = 0;
                  var openTags = [];
                  var tagName = null;
                  for (var i = 0, r = 0; r <= config.showChars; i++) {
                      if (content[i] == '<' && !inTag) {
                          inTag = true;
                          tagName = content.substring(i + 1, content.indexOf('>', i));
                          if (tagName[0] == '/') {
                              if (tagName != '/' + openTags[0]) {
                                  config.errMsg = 'ERROR en HTML: the top of the stack should be the tag that closes';
                              } else {
                                  openTags.shift(); // Pops the last tag from the open tag stack (the tag is closed in the retult HTML!)
                              }
                          } else {
                              if (tagName.toLowerCase() != 'br') {
                                  openTags.unshift(tagName); // Add to start the name of the tag that opens
                              }
                          }
                      }
                      if (inTag && content[i] == '>') {
                          inTag = false;
                      }
                      if (inTag) { bag += content.charAt(i); } // Add tag name chars to the result
                      else {
                          r++;
                          if (countChars <= config.showChars) {
                              bag += content.charAt(i);
                              countChars++;
                          } else
                          {
                              if (openTags.length > 0)
                              {
                                  for (j = 0; j < openTags.length; j++) {
                                      bag += '</' + openTags[j] + '>';
                                  }
                                  break;
                              }
                          }
                      }
                  }
                  c = $('<div/>').html(bag + '<span class="ellip">' + config.ellipsesText + '</span>').html();
              }else{
                  c+=config.ellipsesText;
              }
              var html = '<div class="shortcontent">' + c +
                  '</div><div class="allcontent">' + content +
                  '</div><span><a href="javascript://nop/" class="morelink">' + config.moreText + '</a></span>';
              $this.html(html);
              $this.find(".allcontent").hide();
              $('.shortcontent p:last', $this).css('margin-bottom', 0);
          }
      });
  };
})(jQuery);

$("#contenido").shorten({
	moreText: 'leer mas',
	lessText: 'menos',
  showChars: 50,
});
</script>
